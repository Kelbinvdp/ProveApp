<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">
    <title>ProveApp - Gesti√≥n de Proveedores</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            width: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .container {
            width: 100%;
            max-width: 1200px;
        }

        /* ===== LOGIN SCREEN ===== */
        .login-container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 100%;
            overflow-y: auto;
            max-height: 90vh;
        }

        .login-container h1 {
            color: #333;
            margin-bottom: 5px;
            font-size: 2em;
            word-break: break-word;
        }

        .login-container p {
            color: #999;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        .login-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .login-box {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #eee;
        }

        .login-box h2 {
            font-size: 1.1em;
            color: #333;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
            text-align: left;
        }

        .form-group label {
            display: block;
            font-size: 0.85em;
            color: #666;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-group input, 
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 14px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s;
            font-family: inherit;
            -webkit-appearance: none;
            appearance: none;
        }

        .form-group input:focus, 
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            touch-action: manipulation;
            min-height: 50px;
        }

        button:active {
            transform: scale(0.98);
        }

        button:hover {
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        /* ===== APP SCREEN ===== */
        .app-container {
            display: none;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            flex-direction: column;
            min-height: 90vh;
            max-height: 90vh;
        }

        .app-container.active {
            display: flex;
        }

        /* ===== HEADER ===== */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 1.3em;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-info {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-shrink: 1;
            min-width: 0;
        }

        .user-info span {
            font-size: 0.75em;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            font-size: 0.85em;
            width: auto;
            min-height: auto;
            flex-shrink: 0;
        }

        /* ===== TABS ===== */
        .tabs {
            display: flex;
            gap: 0;
            border-bottom: 1px solid #eee;
            background: white;
            padding: 0 15px;
            flex-shrink: 0;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 15px 20px;
            color: #999;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            width: auto;
            min-height: auto;
            transition: all 0.3s;
        }

        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        /* ===== CONTENT ===== */
        .content {
            padding: 15px;
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ===== STATS ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .stat-card h3 {
            font-size: 0.8em;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .stat-card .value {
            font-size: 1.8em;
            font-weight: bold;
        }

        /* ===== FORMULARIO ===== */
        .form-container {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .form-container h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }

        .form-grid.two-columns {
            grid-template-columns: 1fr 1fr;
        }

        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-family: inherit;
            font-size: 1em;
            resize: vertical;
            min-height: 80px;
        }

        .form-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 12px;
        }

        .form-buttons button {
            margin: 0;
        }

        .btn-secondary {
            background: #999 !important;
        }

        /* ===== TABLA ===== */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: 12px;
            border: 1px solid #eee;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }

        table thead {
            background: #f0f0f0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        table th {
            padding: 12px;
            text-align: left;
            color: #333;
            font-weight: 600;
            border-bottom: 2px solid #ddd;
        }

        table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        table tr:active {
            background: #f9f9f9;
        }

        .badge {
            display: inline-block;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            white-space: nowrap;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 8px 10px;
            font-size: 0.75em;
            width: auto;
            min-height: 40px;
            flex: 1;
            min-width: 60px;
        }

        .btn-edit {
            background: #17a2b8 !important;
        }

        .btn-delete {
            background: #dc3545 !important;
        }

        /* ===== NOTIFICACI√ìN ===== */
        .notification {
            position: fixed;
            top: 20px;
            left: 10px;
            right: 10px;
            padding: 15px;
            border-radius: 10px;
            color: white;
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .notification.success {
            background: #28a745;
            display: block;
        }

        .notification.error {
            background: #dc3545;
            display: block;
        }

        .notification.info {
            background: #17a2b8;
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .hidden {
            display: none;
        }

        .title-section {
            margin-bottom: 15px;
        }

        .title-section h2 {
            color: #333;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .code-box {
            background: #f0f0f0;
            border: 2px solid #667eea;
            padding: 12px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 1.2em;
            text-align: center;
            margin: 10px 0;
            color: #333;
            font-weight: bold;
        }

        .copy-btn {
            background: #28a745 !important;
            padding: 8px 15px;
            width: auto;
            font-size: 0.85em;
            min-height: 40px;
        }

        /* ===== RESPONSIVE ===== */
        @media (min-width: 480px) {
            body {
                padding: 15px;
            }

            .login-container {
                padding: 30px;
            }

            .login-grid {
                grid-template-columns: 1fr 1fr;
                gap: 30px;
            }

            .form-grid.two-columns {
                grid-template-columns: 1fr 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            button {
                padding: 14px 25px;
                min-height: 48px;
            }

            .btn-small {
                min-height: 44px;
            }
        }

        @media (min-width: 768px) {
            .login-grid {
                grid-template-columns: 1fr 1fr;
                gap: 40px;
            }

            .form-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .form-grid.two-columns {
                grid-template-columns: repeat(3, 1fr);
            }

            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 15px;
            }

            .user-info span {
                display: inline;
                font-size: 0.9em;
            }

            table {
                font-size: 1em;
            }

            table th, table td {
                padding: 15px;
            }

            .form-buttons {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (min-width: 1024px) {
            body {
                padding: 20px;
            }

            .content {
                padding: 30px;
            }

            .form-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-height: 500px) {
            .header {
                padding: 10px 15px;
            }

            .header h1 {
                font-size: 1.1em;
            }

            .content {
                padding: 10px;
            }

            .stats-grid {
                gap: 8px;
                margin-bottom: 15px;
            }

            .stat-card {
                padding: 10px;
            }

            .form-container {
                padding: 10px;
            }
        }

        @media print {
            body {
                background: white;
            }

            .header, .form-container, .action-buttons, .logout-btn, .tabs {
                display: none;
            }

            table {
                width: 100%;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>

<!-- LOGIN -->
<div id="loginContainer" class="login-container">
    <h1>üî• ProveApp</h1>
    <p>Gesti√≥n de Proveedores</p>

    <div class="login-grid">
        <!-- Proveedor Login -->
        <div class="login-box">
            <h2>üë§ Proveedor</h2>
            <div class="form-group">
                <label>Tu C√≥digo de Proveedor</label>
                <input type="text" id="proveedorCodigo" placeholder="Ej: PROV-ABC123" autocomplete="off">
            </div>
            <button onclick="loginProveedor()">Acceder</button>
            <p style="margin-top: 12px; color: #999; font-size: 0.8em;">Si no tienes c√≥digo, pide uno al administrador</p>
        </div>

        <!-- Admin Login -->
        <div class="login-box">
            <h2>‚öôÔ∏è Administrador</h2>
            <div class="form-group">
                <label>Usuario</label>
                <input type="text" id="adminUser" placeholder="admin" value="admin" autocomplete="username">
            </div>
            <div class="form-group">
                <label>Contrase√±a</label>
                <input type="password" id="adminPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value="admin123" autocomplete="current-password">
            </div>
            <button onclick="loginAdmin()">Acceder</button>
            <p style="margin-top: 12px; color: #999; font-size: 0.8em;">Demo: admin/admin123</p>
        </div>
    </div>
</div>

<!-- APP -->
<div id="appContainer" class="app-container">
    <!-- Header -->
    <div class="header">
        <h1>üìÖ ProveApp</h1>
        <div class="user-info">
            <span>Usuario:</span>
            <span id="usuarioNombre">‚Äî</span>
            <button class="logout-btn" onclick="logout()" title="Cerrar sesi√≥n">üö™</button>
        </div>
    </div>

    <!-- TABS -->
    <div class="tabs" id="tabsContainer"></div>

    <!-- Content -->
    <div class="content">
        <!-- TAB: RESERVAS -->
        <div id="tabReservas" class="tab-content active">
            <!-- STATS -->
            <div class="stats-grid" id="statsContainer"></div>

            <!-- FORM -->
            <div class="form-container" id="formContainer" style="display: none;">
                <h2>‚ûï Nueva Reserva</h2>
                <div class="form-grid two-columns">
                    <div class="form-group">
                        <label>Fecha</label>
                        <input type="date" id="formFecha">
                    </div>
                    <div class="form-group">
                        <label>Hora Inicio</label>
                        <input type="time" id="formHoraInicio">
                    </div>
                </div>
                <div class="form-grid two-columns">
                    <div class="form-group">
                        <label>Hora Final</label>
                        <input type="time" id="formHoraFinal">
                    </div>
                    <div class="form-group">
                        <label>Monto ($)</label>
                        <input type="number" id="formMonto" placeholder="500" step="0.01" min="0">
                    </div>
                </div>
                <div class="form-grid two-columns">
                    <div class="form-group">
                        <label>Sal√≥n</label>
                        <input type="text" id="formSalon" placeholder="Sal√≥n Principal">
                    </div>
                    <div class="form-group">
                        <label>Vestimenta</label>
                        <input type="text" id="formVestimenta" placeholder="Formal">
                    </div>
                </div>
                <div class="form-group">
                    <label>Notas</label>
                    <textarea id="formNotas" placeholder="Notas especiales..."></textarea>
                </div>
                <div class="form-buttons">
                    <button onclick="guardarReserva()">üíæ Guardar</button>
                    <button class="btn-secondary" onclick="cancelarFormulario()">‚úï Cancelar</button>
                </div>
            </div>

            <!-- TABLE -->
            <div class="title-section">
                <h2>üìã Mis Reservas</h2>
            </div>
            <div class="table-container">
                <table id="tablaReservas">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Horario</th>
                            <th>Sal√≥n</th>
                            <th>Estado</th>
                            <th>Monto</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaReservasBody">
                        <tr>
                            <td colspan="6" style="text-align: center; color: #999;">Cargando...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- TAB: ADMIN PROVEEDORES (Solo para Admin) -->
        <div id="tabProveedores" class="tab-content" style="display: none;">
            <div class="form-container">
                <h2>‚ûï Crear Nuevo Proveedor</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nombre del Proveedor</label>
                        <input type="text" id="adminNombreProveedor" placeholder="Ej: Juan Garc√≠a">
                    </div>
                    <div class="form-group">
                        <label>Email (Opcional)</label>
                        <input type="email" id="adminEmailProveedor" placeholder="email@ejemplo.com">
                    </div>
                </div>
                <div class="form-group">
                    <label>Descripci√≥n</label>
                    <textarea id="adminDescProveedor" placeholder="Descripci√≥n del proveedor..."></textarea>
                </div>
                <button onclick="crearProveedor()" style="margin-top: 10px;">üîë Generar C√≥digo</button>
            </div>

            <!-- TABLA PROVEEDORES -->
            <div class="title-section">
                <h2>üìã Proveedores Registrados</h2>
            </div>
            <div class="table-container">
                <table id="tablaProveedores">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>C√≥digo</th>
                            <th>Reservas</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaProveedoresBody">
                        <tr>
                            <td colspan="4" style="text-align: center; color: #999;">Cargando...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- TAB: TODAS LAS RESERVAS (Solo para Admin) -->
        <div id="tabTodasReservas" class="tab-content" style="display: none;">
            <div class="title-section">
                <h2>üìä Todas las Reservas</h2>
            </div>
            <div class="table-container">
                <table id="tablaTodasReservas">
                    <thead>
                        <tr>
                            <th>Proveedor</th>
                            <th>Fecha</th>
                            <th>Horario</th>
                            <th>Sal√≥n</th>
                            <th>Estado</th>
                            <th>Monto</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaTodasReservasBody">
                        <tr>
                            <td colspan="7" style="text-align: center; color: #999;">Cargando...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- NOTIFICATION -->
<div id="notification" class="notification"></div>

<!-- FIREBASE SCRIPTS -->
<script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js"></script>

<script>
    // ========================================
    // 1Ô∏è‚É£ VARIABLES GLOBALES
    // ========================================
    let usuarioActual = null;
    let rolActual = null;
    let proveedorActual = null;
    let reservas = [];
    let proveedores = [];
    let editandoId = null;
    let db = null;
    let auth = null;
    let firebaseActivo = false;

    // ========================================
    // 2Ô∏è‚É£ FIREBASE CONFIG
    // ========================================
    const firebaseConfig = {
        apiKey: "AIzaSyAMB9h7cNxaSiTbrjYfbHaA58QDgqbAayM",
        authDomain: "proveapp-35793.firebaseapp.com",
        projectId: "proveapp-35793",
        storageBucket: "proveapp-35793.firebasestorage.app",
        messagingSenderId: "734706343214",
        appId: "1:734706343214:web:c6acde37c1d491864a6ebf"
    };

    // ========================================
    // 3Ô∏è‚É£ INICIALIZAR FIREBASE
    // ========================================
    try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        auth = firebase.auth();
        firebaseActivo = true;
        console.log('‚úÖ Firebase inicializado correctamente');
    } catch (error) {
        firebaseActivo = false;
        console.error('‚ùå Error Firebase:', error);
        mostrarNotificacion('‚ö†Ô∏è Firebase no disponible - Usando modo local', 'info');
    }

    // ========================================
    // GENERAR C√ìDIGO √öNICO
    // ========================================
    function generarCodigoProveedor() {
        const caracteres = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let codigo = 'PROV-';
        for (let i = 0; i < 6; i++) {
            codigo += caracteres.charAt(Math.floor(Math.random() * caracteres.length));
        }
        return codigo;
    }

    // ========================================
    // LOGIN
    // ========================================
    function loginProveedor() {
        const codigo = document.getElementById('proveedorCodigo').value.trim();
        if (!codigo) {
            mostrarNotificacion('Ingresa tu c√≥digo de proveedor', 'error');
            return;
        }

        if (firebaseActivo) {
            // Buscar proveedor en Firestore
            db.collection('proveedores')
                .where('codigo', '==', codigo)
                .limit(1)
                .get()
                .then(querySnapshot => {
                    if (querySnapshot.empty) {
                        mostrarNotificacion('‚ùå C√≥digo no encontrado', 'error');
                        return;
                    }

                    const doc = querySnapshot.docs[0];
                    usuarioActual = doc.data().nombre;
                    proveedorActual = codigo;
                    rolActual = 'proveedor';
                    
                    cargarDatos();
                    mostrarApp();
                    mostrarNotificacion('¬°Bienvenido ' + usuarioActual + '!', 'success');
                })
                .catch(error => {
                    console.error('Error:', error);
                    mostrarNotificacion('‚ùå Error al verificar c√≥digo', 'error');
                });
        } else {
            // Modo local sin Firebase
            usuarioActual = 'Proveedor - ' + codigo;
            proveedorActual = codigo;
            rolActual = 'proveedor';
            cargarDatos();
            mostrarApp();
            mostrarNotificacion('¬°Bienvenido! (Modo local)', 'success');
        }
    }

    function loginAdmin() {
        const user = document.getElementById('adminUser').value.trim();
        const pass = document.getElementById('adminPass').value.trim();

        if (user !== 'admin' || pass !== 'admin123') {
            mostrarNotificacion('Credenciales incorrectas', 'error');
            return;
        }

        usuarioActual = 'ADMIN';
        rolActual = 'admin';
        cargarDatos();
        mostrarApp();
        mostrarNotificacion('¬°Bienvenido Admin!', 'success');
    }

    function logout() {
        usuarioActual = null;
        rolActual = null;
        proveedorActual = null;
        reservas = [];
        proveedores = [];
        document.getElementById('appContainer').classList.remove('active');
        document.getElementById('loginContainer').style.display = 'block';
        mostrarNotificacion('Sesi√≥n cerrada', 'success');
    }

    // ========================================
    // CARGAR DATOS
    // ========================================
    async function cargarDatos() {
        if (rolActual === 'admin') {
            cargarProveedores();
            cargarTodasReservas();
        }
        
        if (rolActual === 'proveedor') {
            cargarReservasProveedor();
        }
    }

    async function cargarReservasProveedor() {
        if (!db || !firebaseActivo) {
            reservas = [];
            actualizarUI();
            return;
        }

        try {
            const querySnapshot = await db.collection('reservas')
                .where('codigoProveedor', '==', proveedorActual)
                .orderBy('fecha', 'desc')
                .get();

            reservas = [];
            querySnapshot.forEach((doc) => {
                reservas.push({ id: doc.id, ...doc.data() });
            });
            
            console.log('‚úÖ Reservas cargadas:', reservas.length);
            actualizarUI();
        } catch (error) {
            console.error('Error cargando reservas:', error);
            mostrarNotificacion('‚ö†Ô∏è Error al cargar reservas', 'error');
            actualizarUI();
        }
    }

    async function cargarTodasReservas() {
        if (!db || !firebaseActivo) {
            return;
        }

        try {
            const querySnapshot = await db.collection('reservas')
                .orderBy('fecha', 'desc')
                .get();

            let todas = [];
            querySnapshot.forEach((doc) => {
                todas.push({ id: doc.id, ...doc.data() });
            });
            
            actualizarTablaTodasReservas(todas);
        } catch (error) {
            console.error('Error:', error);
        }
    }

    async function cargarProveedores() {
        if (!db || !firebaseActivo) {
            proveedores = [];
            actualizarTablaProveedores();
            return;
        }

        try {
            const querySnapshot = await db.collection('proveedores')
                .orderBy('fechaCreacion', 'desc')
                .get();

            proveedores = [];
            querySnapshot.forEach((doc) => {
                proveedores.push({ id: doc.id, ...doc.data() });
            });
            
            actualizarTablaProveedores();
        } catch (error) {
            console.error('Error:', error);
        }
    }

    // ========================================
    // UI
    // ========================================
    function mostrarApp() {
        document.getElementById('loginContainer').style.display = 'none';
        document.getElementById('appContainer').classList.add('active');
        document.getElementById('usuarioNombre').textContent = usuarioActual;
        
        // Mostrar tabs seg√∫n rol
        const tabsContainer = document.getElementById('tabsContainer');
        tabsContainer.innerHTML = '';

        if (rolActual === 'proveedor') {
            tabsContainer.innerHTML = `
                <button class="tab-button active" onclick="cambiarTab('tabReservas')">üìã Mis Reservas</button>
            `;
            document.getElementById('formContainer').style.display = 'block';
        } else if (rolActual === 'admin') {
            tabsContainer.innerHTML = `
                <button class="tab-button active" onclick="cambiarTab('tabReservas')">üìã Reservas</button>
                <button class="tab-button" onclick="cambiarTab('tabProveedores')">üë• Proveedores</button>
                <button class="tab-button" onclick="cambiarTab('tabTodasReservas')">üìä Todas</button>
            `;
            document.getElementById('formContainer').style.display = 'none';
            document.getElementById('tabProveedores').style.display = 'block';
            document.getElementById('tabTodasReservas').style.display = 'block';
        }
    }

    function cambiarTab(tabId) {
        // Esconder todos los tabs
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // Desactivar todos los botones
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.classList.remove('active');
        });

        // Mostrar tab seleccionado
        document.getElementById(tabId).classList.add('active');
        
        // Activar bot√≥n
        event.target.classList.add('active');

        if (tabId === 'tabTodasReservas') {
            cargarTodasReservas();
        } else if (tabId === 'tabProveedores') {
            cargarProveedores();
        }
    }

    function actualizarUI() {
        const total = reservas.length;
        const confirmadas = reservas.filter(r => r.estado === 'confirmada').length;
        const canceladas = total - confirmadas;
        const ingresos = reservas
            .filter(r => r.estado === 'confirmada')
            .reduce((sum, r) => sum + (parseFloat(r.monto) || 0), 0);

        const statsHTML = `
            <div class="stat-card">
                <h3>üìä Total</h3>
                <div class="value">${total}</div>
            </div>
            <div class="stat-card">
                <h3>‚úÖ Confirmadas</h3>
                <div class="value">${confirmadas}</div>
            </div>
            <div class="stat-card">
                <h3>‚ùå Canceladas</h3>
                <div class="value">${canceladas}</div>
            </div>
            <div class="stat-card">
                <h3>üí∞ Ingresos</h3>
                <div class="value">$${ingresos.toFixed(0)}</div>
            </div>
        `;
        document.getElementById('statsContainer').innerHTML = statsHTML;

        if (reservas.length === 0) {
            document.getElementById('tablaReservasBody').innerHTML = 
                '<tr><td colspan="6" style="text-align: center; color: #999;">No hay reservas</td></tr>';
            return;
        }

        const tablaHTML = reservas.map(r => `
            <tr>
                <td>${r.fecha}</td>
                <td>${r.horaInicio}<br><small style="color:#999;">${r.horaFinal}</small></td>
                <td>${r.salon}</td>
                <td><span class="badge badge-${r.estado === 'confirmada' ? 'success' : 'danger'}">
                    ${r.estado === 'confirmada' ? '‚úì' : '‚úó'}
                </span></td>
                <td>$${parseFloat(r.monto).toFixed(0)}</td>
                <td>
                    <div class="action-buttons">
                        <button class="btn-small btn-edit" onclick="editarReserva('${r.id}')">‚úèÔ∏è</button>
                        <button class="btn-small btn-delete" onclick="eliminarReserva('${r.id}')">üóëÔ∏è</button>
                    </div>
                </td>
            </tr>
        `).join('');

        document.getElementById('tablaReservasBody').innerHTML = tablaHTML;
    }

    function actualizarTablaProveedores() {
        if (proveedores.length === 0) {
            document.getElementById('tablaProveedoresBody').innerHTML = 
                '<tr><td colspan="4" style="text-align: center; color: #999;">Sin proveedores</td></tr>';
            return;
        }

        const tablaHTML = proveedores.map(p => {
            const reservasProveedor = reservas.filter(r => r.codigoProveedor === p.codigo).length;
            return `
                <tr>
                    <td>${p.nombre}</td>
                    <td>
                        <div class="code-box">${p.codigo}</div>
                        <button class="copy-btn btn-small" onclick="copiarCodigo('${p.codigo}')">üìã Copiar</button>
                    </td>
                    <td>${reservasProveedor}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-small btn-delete" onclick="eliminarProveedor('${p.id}')">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `;
        }).join('');

        document.getElementById('tablaProveedoresBody').innerHTML = tablaHTML;
    }

    function actualizarTablaTodasReservas(todas) {
        if (todas.length === 0) {
            document.getElementById('tablaTodasReservasBody').innerHTML = 
                '<tr><td colspan="7" style="text-align: center; color: #999;">Sin reservas</td></tr>';
            return;
        }

        const tablaHTML = todas.map(r => {
            const proveedor = proveedores.find(p => p.codigo === r.codigoProveedor);
            return `
                <tr>
                    <td>${proveedor ? proveedor.nombre : r.codigoProveedor}</td>
                    <td>${r.fecha}</td>
                    <td>${r.horaInicio}<br><small>${r.horaFinal}</small></td>
                    <td>${r.salon}</td>
                    <td><span class="badge badge-${r.estado === 'confirmada' ? 'success' : 'danger'}">
                        ${r.estado === 'confirmada' ? '‚úì' : '‚úó'}
                    </span></td>
                    <td>$${parseFloat(r.monto).toFixed(0)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-small btn-delete" onclick="eliminarReservaAdmin('${r.id}')">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `;
        }).join('');

        document.getElementById('tablaTodasReservasBody').innerHTML = tablaHTML;
    }

    // ========================================
    // CREAR PROVEEDOR
    // ========================================
    async function crearProveedor() {
        const nombre = document.getElementById('adminNombreProveedor').value.trim();
        const email = document.getElementById('adminEmailProveedor').value.trim();
        const descripcion = document.getElementById('adminDescProveedor').value.trim();

        if (!nombre) {
            mostrarNotificacion('Ingresa el nombre del proveedor', 'error');
            return;
        }

        const codigo = generarCodigoProveedor();

        if (!firebaseActivo) {
            mostrarNotificacion('‚ùå Firebase no disponible', 'error');
            return;
        }

        try {
            await db.collection('proveedores').add({
                nombre: nombre,
                codigo: codigo,
                email: email,
                descripcion: descripcion,
                fechaCreacion: new Date(),
                activo: true
            });

            mostrarNotificacion(`‚úÖ Proveedor creado: ${codigo}`, 'success');
            
            // Limpiar formulario
            document.getElementById('adminNombreProveedor').value = '';
            document.getElementById('adminEmailProveedor').value = '';
            document.getElementById('adminDescProveedor').value = '';

            cargarProveedores();
        } catch (error) {
            console.error('Error:', error);
            mostrarNotificacion('‚ùå Error al crear proveedor', 'error');
        }
    }

    async function eliminarProveedor(id) {
        if (!confirm('¬øEliminar este proveedor?')) return;

        try {
            await db.collection('proveedores').doc(id).delete();
            mostrarNotificacion('‚úÖ Proveedor eliminado', 'success');
            cargarProveedores();
        } catch (error) {
            console.error('Error:', error);
            mostrarNotificacion('‚ùå Error al eliminar', 'error');
        }
    }

    function copiarCodigo(codigo) {
        navigator.clipboard.writeText(codigo).then(() => {
            mostrarNotificacion('‚úÖ C√≥digo copiado: ' + codigo, 'success');
        });
    }

    // ========================================
    // FORMULARIO RESERVAS
    // ========================================
    async function guardarReserva() {
        const fecha = document.getElementById('formFecha').value;
        const horaInicio = document.getElementById('formHoraInicio').value;
        const horaFinal = document.getElementById('formHoraFinal').value;
        const salon = document.getElementById('formSalon').value.trim();
        const vestimenta = document.getElementById('formVestimenta').value.trim();
        const monto = document.getElementById('formMonto').value;
        const notas = document.getElementById('formNotas').value.trim();

        if (!fecha || !horaInicio || !horaFinal || !salon || !vestimenta || !monto) {
            mostrarNotificacion('‚ö†Ô∏è Completa todos los campos', 'error');
            return;
        }

        if (parseFloat(monto) <= 0) {
            mostrarNotificacion('‚ö†Ô∏è Monto debe ser mayor a 0', 'error');
            return;
        }

        if (!firebaseActivo) {
            mostrarNotificacion('‚ùå Firebase no disponible', 'error');
            return;
        }

        try {
            const reserva = {
                fecha: fecha,
                horaInicio: horaInicio,
                horaFinal: horaFinal,
                salon: salon,
                vestimenta: vestimenta,
                monto: monto,
                estado: 'confirmada',
                notas: notas,
                codigoProveedor: proveedorActual,
                nombreProveedor: usuarioActual,
                createdAt: new Date()
            };

            await db.collection('reservas').add(reserva);
            
            mostrarNotificacion('‚úÖ Reserva guardada en Firebase', 'success');
            limpiarFormulario();
            cargarReservasProveedor();
        } catch (error) {
            console.error('Error guardando:', error);
            mostrarNotificacion('‚ùå Error al guardar: ' + error.message, 'error');
        }
    }

    function editarReserva(id) {
        const reserva = reservas.find(r => r.id === id);
        if (reserva) {
            document.getElementById('formFecha').value = reserva.fecha;
            document.getElementById('formHoraInicio').value = reserva.horaInicio;
            document.getElementById('formHoraFinal').value = reserva.horaFinal;
            document.getElementById('formSalon').value = reserva.salon;
            document.getElementById('formVestimenta').value = reserva.vestimenta;
            document.getElementById('formMonto').value = reserva.monto;
            document.getElementById('formNotas').value = reserva.notas;
            editandoId = id;
            document.querySelector('.form-container').scrollIntoView({ behavior: 'smooth' });
        }
    }

    async function eliminarReserva(id) {
        if (!confirm('¬øEliminar esta reserva?')) return;

        try {
            await db.collection('reservas').doc(id).delete();
            mostrarNotificacion('‚úÖ Reserva eliminada', 'success');
            cargarReservasProveedor();
        } catch (error) {
            console.error('Error:', error);
            mostrarNotificacion('‚ùå Error al eliminar', 'error');
        }
    }

    async function eliminarReservaAdmin(id) {
        if (!confirm('¬øEliminar esta reserva?')) return;

        try {
            await db.collection('reservas').doc(id).delete();
            mostrarNotificacion('‚úÖ Reserva eliminada', 'success');
            cargarTodasReservas();
        } catch (error) {
            console.error('Error:', error);
        }
    }

    function cancelarFormulario() {
        limpiarFormulario();
    }

    function limpiarFormulario() {
        document.getElementById('formFecha').value = '';
        document.getElementById('formHoraInicio').value = '';
        document.getElementById('formHoraFinal').value = '';
        document.getElementById('formSalon').value = '';
        document.getElementById('formVestimenta').value = '';
        document.getElementById('formMonto').value = '';
        document.getElementById('formNotas').value = '';
        editandoId = null;
    }

    // ========================================
    // NOTIFICACIONES
    // ========================================
    function mostrarNotificacion(mensaje, tipo) {
        const notif = document.getElementById('notification');
        notif.textContent = mensaje;
        notif.className = `notification ${tipo}`;
        setTimeout(() => {
            notif.className = 'notification';
        }, 4000);
    }

    // ========================================
    // INICIALIZACI√ìN
    // ========================================
    window.addEventListener('load', () => {
        console.log('‚úÖ ProveApp Mobile cargada');
        if (firebaseActivo) {
            console.log('‚úÖ Firebase disponible');
        } else {
            console.warn('‚ö†Ô∏è Firebase no disponible - modo local');
        }
    });

    document.addEventListener('touchmove', function(event) {
        if (event.touches.length > 1) {
            event.preventDefault();
        }
    }, { passive: false });
</script>

</body>
</html>
